(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18566,(e,t,s)=>{t.exports=e.r(76562)},59544,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(75157);let a=(0,s.forwardRef)(({className:e,variant:s="primary",size:a="md",fullWidth:l,loading:n,disabled:i,children:c,...o},d)=>(0,t.jsxs)("button",{ref:d,className:(0,r.cn)("inline-flex items-center justify-center font-semibold transition-all duration-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed active:scale-[0.98]",{primary:"bg-blue-600 text-white hover:bg-blue-700 focus:ring-blue-500 shadow-md hover:shadow-lg",secondary:"bg-gray-100 text-gray-800 hover:bg-gray-200 focus:ring-gray-400",outline:"border-2 border-blue-600 text-blue-600 hover:bg-blue-50 focus:ring-blue-500",ghost:"text-gray-600 hover:bg-gray-100 focus:ring-gray-400",danger:"bg-red-500 text-white hover:bg-red-600 focus:ring-red-400 shadow-md"}[s],{sm:"px-3 py-1.5 text-sm rounded-lg",md:"px-4 py-2.5 text-sm",lg:"px-6 py-3 text-base",xl:"px-8 py-4 text-lg"}[a],l&&"w-full",e),disabled:i||n,...o,children:[n&&(0,t.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),c]}));a.displayName="Button",e.s(["default",0,a])},39964,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(75157);let a=(0,s.forwardRef)(({className:e,hoverable:s,padding:a="md",children:l,...n},i)=>(0,t.jsx)("div",{ref:i,className:(0,r.cn)("bg-white rounded-2xl border border-gray-100","shadow-sm",{none:"",sm:"p-4",md:"p-5",lg:"p-6"}[a],s&&"hover:shadow-md hover:border-gray-200 transition-all duration-200 cursor-pointer",e),...n,children:l}));a.displayName="Card",e.s(["default",0,a])},43531,e=>{"use strict";let t=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},74875,e=>{"use strict";let t=(0,e.i(75254).default)("circle-question-mark",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);e.s(["HelpCircle",()=>t],74875)},69638,e=>{"use strict";let t=(0,e.i(75254).default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);e.s(["CheckCircle",()=>t],69638)},94351,e=>{"use strict";let t=(0,e.i(75254).default)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);e.s(["Home",()=>t],94351)},70255,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(18566),a=e.i(92028),l=e.i(9165),n=e.i(39964),i=e.i(59544),c=e.i(43531),o=e.i(74875),d=e.i(37727);function m({content:e,optionName:r}){let[a,l]=(0,s.useState)(!1);return e?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("button",{onClick:e=>{e.stopPropagation(),l(!0)},className:"p-0.5 text-blue-400 hover:text-blue-600 transition-colors",children:(0,t.jsx)(o.HelpCircle,{className:"w-4 h-4"})}),a&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center",children:(0,t.jsxs)("div",{className:"bg-white rounded-t-2xl sm:rounded-2xl p-5 w-full max-w-sm sm:mx-4 space-y-3 animate-in slide-in-from-bottom duration-200",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"font-bold text-gray-900",children:r}),(0,t.jsx)("button",{onClick:()=>l(!1),className:"p-1 hover:bg-gray-100 rounded-lg",children:(0,t.jsx)(d.X,{className:"w-5 h-5 text-gray-400"})})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 whitespace-pre-wrap leading-relaxed",children:e})]})})]}):null}function x({partners:e,selectedRows:s,onToggleRow:r}){return(0,t.jsx)("div",{className:"space-y-6",children:e.map(e=>(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-sm font-bold text-gray-500 uppercase tracking-wider mb-3",children:e.partnerName}),e.categories.map(a=>(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h4",{className:"text-base font-bold text-gray-900 mb-2",children:a.categoryName}),(0,t.jsx)("div",{className:"border border-gray-200 rounded-xl overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{className:"bg-gray-50 border-b border-gray-200",children:[(0,t.jsx)("th",{className:"px-2 py-2 w-8"}),(0,t.jsx)("th",{className:"px-3 py-2 text-left font-medium text-gray-600 min-w-[160px] sticky left-0 bg-gray-50 z-10",children:"옵션"}),(0,t.jsx)("th",{className:"px-1 py-2 w-6"}),a.columns.map(e=>(0,t.jsxs)("th",{className:"px-2 py-2 text-center min-w-[90px]",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-gray-600",children:e.customName||`열`}),(0,t.jsx)("div",{className:"mt-0.5",children:(0,t.jsx)("span",{className:`inline-block text-[10px] px-1.5 py-0.5 rounded-full font-medium ${"text"===e.columnType?"bg-gray-100 text-gray-500":"bg-blue-100 text-blue-600"}`,children:"text"===e.columnType?"텍스트":"금액"})})]},e.id))]})}),(0,t.jsxs)("tbody",{children:[a.options.map(l=>{let n,i,o=(n=a.sheetId,i=l.rowId,s.some(e=>e.sheetId===n&&e.rowId===i));return(0,t.jsxs)("tr",{onClick:()=>r(a.sheetId,l.rowId,l.optionName,a.categoryName,e.partnerName),className:`border-b border-gray-100 cursor-pointer transition-colors ${o?"bg-blue-50":"hover:bg-gray-50"}`,children:[(0,t.jsx)("td",{className:"px-2 py-2 text-center",children:(0,t.jsx)("div",{className:`w-5 h-5 rounded-full border-2 flex items-center justify-center mx-auto ${o?"border-blue-500 bg-blue-500":"border-gray-300"}`,children:o&&(0,t.jsx)(c.Check,{className:"w-3 h-3 text-white"})})}),(0,t.jsx)("td",{className:`px-3 py-2 sticky left-0 z-10 ${o?"bg-blue-50":"bg-white"}`,children:(0,t.jsx)("span",{className:`text-sm font-medium ${o?"text-blue-700":"text-gray-900"}`,children:l.optionName})}),(0,t.jsx)("td",{className:"px-1 py-2 text-center",children:l.popupContent&&(0,t.jsx)(m,{content:l.popupContent,optionName:l.optionName})}),a.columns.map(e=>{let s="amount"===e.columnType,r=l.cellValues?.[e.id],a=l.prices?.[e.id],n=void 0!==r?r:void 0!==a?String(a):"";return(0,t.jsx)("td",{className:`px-2 py-2 ${s?"text-right":"text-center"}`,children:(0,t.jsx)("span",{className:`text-sm ${o?"text-blue-600 font-medium":"text-gray-700"}`,children:s?Number(n)?`${Number(n).toLocaleString()}원`:"-":n||"-"})},e.id)})]},l.rowId)}),0===a.options.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:a.columns.length+3,className:"px-4 py-6 text-center text-gray-400 text-sm",children:"등록된 옵션이 없습니다."})})]})]})})]},a.sheetId))]},e.partnerId))})}function u({items:e,paymentStages:s}){let r,a,l=e.reduce((e,t)=>e+t.unitPrice,0),n=s.length>0?(r=s.map(e=>({name:e.name,ratio:e.ratio,amount:Math.round(l*e.ratio/100)})),0!=(a=l-r.reduce((e,t)=>e+t.amount,0))&&r.length>0&&(r[r.length-1].amount+=a),r):[{name:"일시불",ratio:100,amount:l}],i=e.reduce((e,t)=>{let s=`${t.partnerName} - ${t.categoryName}`;return e[s]||(e[s]=[]),e[s].push(t),e},{});return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-bold text-gray-500 mb-2",children:"선택 내역"}),0===e.length?(0,t.jsx)("p",{className:"text-sm text-gray-400",children:"선택된 품목이 없습니다."}):(0,t.jsx)("div",{className:"space-y-3",children:Object.entries(i).map(([e,s])=>(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-400 mb-1",children:e}),s.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between py-1",children:[(0,t.jsx)("span",{className:"text-sm text-gray-700",children:e.optionName}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-900",children:e.unitPrice?`${e.unitPrice.toLocaleString()}원`:"무료"})]},s))]},e))})]}),(0,t.jsx)("div",{className:"border-t border-gray-200 pt-3",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("span",{className:"font-bold text-gray-900",children:"총액"}),(0,t.jsxs)("span",{className:"text-xl font-bold text-blue-600",children:[l.toLocaleString(),"원"]})]})}),e.length>0&&(0,t.jsxs)("div",{className:"bg-gray-50 rounded-xl p-3 space-y-2",children:[(0,t.jsx)("h4",{className:"text-sm font-bold text-gray-500",children:"결제 스케줄"}),n.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-sm text-gray-600",children:[e.name||`${s+1}차`," (",e.ratio,"%)"]}),(0,t.jsxs)("span",{className:"text-sm font-medium text-gray-900",children:[e.amount.toLocaleString(),"원"]})]},s))]})]})}var h=e.i(88840),g=e.i(75254);let p=(0,g.default)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]),y=(0,g.default)("pen-tool",[["path",{d:"M15.707 21.293a1 1 0 0 1-1.414 0l-1.586-1.586a1 1 0 0 1 0-1.414l5.586-5.586a1 1 0 0 1 1.414 0l1.586 1.586a1 1 0 0 1 0 1.414z",key:"nt11vn"}],["path",{d:"m18 13-1.375-6.874a1 1 0 0 0-.746-.776L3.235 2.028a1 1 0 0 0-1.207 1.207L5.35 15.879a1 1 0 0 0 .776.746L13 18",key:"15qc1e"}],["path",{d:"m2.3 2.3 7.286 7.286",key:"1wuzzi"}],["circle",{cx:"11",cy:"11",r:"2",key:"xmgehs"}]]);var f=e.i(69638),b=e.i(94351);function j(){let{code:e}=(0,r.useParams)(),c=(0,r.useRouter)(),{toast:o}=(0,h.useToast)(),{user:d,isAuthenticated:m}=(0,a.useAuthStore)(),[g,j]=(0,s.useState)(null),[N,w]=(0,s.useState)(!0),[v,k]=(0,s.useState)([]),[I,C]=(0,s.useState)("select"),[S,T]=(0,s.useState)(!1),[$,M]=(0,s.useState)(!1),[z,R]=(0,s.useState)(""),[L,P]=(0,s.useState)(""),[A,H]=(0,s.useState)(""),[B,D]=(0,s.useState)(""),U=(0,s.useRef)(null),[W,E]=(0,s.useState)(!1),[F,O]=(0,s.useState)(!1);(0,s.useEffect)(()=>{l.default.get(`/ic/contract-flow-by-code/${e}`).then(e=>{let t=(0,l.extractData)(e);j(t),1===t.apartmentTypes.length&&D(t.apartmentTypes[0].id)}).catch(()=>{}).finally(()=>w(!1))},[e]),(0,s.useEffect)(()=>{d&&(R(d.name||""),P(d.phone||""))},[d]);let V=e=>g?v.map(t=>{for(let s of g.partners)for(let r of s.categories){if(r.sheetId!==t.sheetId)continue;let s=r.options.find(e=>e.rowId===t.rowId);if(!s)continue;let a=r.columns.find(t=>t.apartmentTypeId===e),l=a?.id||"",n=s.cellValues?.[l],i=void 0!==n?Number(n)||0:s.prices?.[l]??0;return{sheetId:t.sheetId,rowId:t.rowId,columnId:l,optionName:t.optionName,categoryName:t.categoryName,partnerName:t.partnerName,unitPrice:i}}return{sheetId:t.sheetId,rowId:t.rowId,columnId:"",optionName:t.optionName,categoryName:t.categoryName,partnerName:t.partnerName,unitPrice:0}}):[],X=e=>{let t=U.current;if(!t)return{x:0,y:0};let s=t.getBoundingClientRect();return"touches"in e?{x:e.touches[0].clientX-s.left,y:e.touches[0].clientY-s.top}:{x:e.clientX-s.left,y:e.clientY-s.top}},q=e=>{let t=U.current?.getContext("2d");if(!t)return;E(!0);let s=X(e);t.beginPath(),t.moveTo(s.x,s.y)},K=e=>{if(!W)return;let t=U.current?.getContext("2d");if(!t)return;let s=X(e);t.lineTo(s.x,s.y),t.strokeStyle="#1e293b",t.lineWidth=2,t.lineCap="round",t.stroke(),O(!0)},Y=()=>E(!1),G=async()=>{if(!m)return void c.push(`/login?redirect=/events/${e}/options`);if(!g||0===v.length)return void o("품목을 선택해주세요.","error");if(!B)return void o("아파트 타입을 선택해주세요.","error");if(!$&&g.config.legalTerms)return void o("약관에 동의해주세요.","error");if(!F)return void o("서명을 해주세요.","error");T(!0);try{let e=V(B),t=U.current?.toDataURL("image/png")||"",s=await l.default.post("/ic/contracts",{configId:g.config.id,apartmentTypeId:B,selectedItems:e.map(e=>({sheetId:e.sheetId,rowId:e.rowId,columnId:e.columnId})),legalAgreed:!0,signatureData:t,customerName:z||void 0,customerPhone:L||void 0,specialNotes:A||void 0}),r=(0,l.extractData)(s);o("계약이 완료되었습니다!","success"),c.push(`/customer/integrated-contracts/${r.id}`)}catch(t){let e=t?.response?.data?.message;o(Array.isArray(e)?e[0]:e||"계약 생성에 실패했습니다.","error")}finally{T(!1)}};if(N)return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsx)("div",{className:"w-full max-w-2xl mx-auto p-4 space-y-4",children:[1,2,3].map(e=>(0,t.jsx)("div",{className:"h-24 bg-white rounded-2xl animate-pulse"},e))})});if(!g)return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-4",children:(0,t.jsxs)(n.default,{className:"max-w-sm w-full text-center",children:[(0,t.jsx)(b.Home,{className:"w-12 h-12 text-gray-300 mx-auto mb-3"}),(0,t.jsx)("p",{className:"font-bold text-gray-900",children:"통합 계약 설정을 찾을 수 없습니다"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"행사 정보를 확인해주세요."})]})});let J=B?V(B):[];return(0,t.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,t.jsxs)("div",{className:"max-w-2xl mx-auto p-4 space-y-4",children:[(0,t.jsxs)("button",{onClick:()=>"sign"===I?C("select"):c.back(),className:"flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700",children:[(0,t.jsx)(p,{className:"w-4 h-4"}),"sign"===I?"옵션 선택으로":"뒤로"]}),"select"===I&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"옵션 선택"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"전체 가격표에서 원하시는 품목을 선택해주세요"})]}),(0,t.jsx)(x,{partners:g.partners,selectedRows:v.map(e=>({sheetId:e.sheetId,rowId:e.rowId})),onToggleRow:(e,t,s,r,a)=>{k(l=>l.find(s=>s.sheetId===e&&s.rowId===t)?l.filter(s=>s.sheetId!==e||s.rowId!==t):[...l,{sheetId:e,rowId:t,optionName:s,categoryName:r,partnerName:a}])}}),v.length>0&&(0,t.jsxs)("div",{className:"text-sm text-gray-500 text-center",children:[v.length,"개 품목 선택됨"]}),(0,t.jsxs)(i.default,{fullWidth:!0,size:"lg",disabled:0===v.length,onClick:()=>C("sign"),children:[(0,t.jsx)(y,{className:"w-5 h-5 mr-2"}),"서명하기 (",v.length,"개 선택)"]})]}),"sign"===I&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-900",children:"계약 서명"}),(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"타입을 선택하고, 내용을 확인한 후 서명해주세요"})]}),g.apartmentTypes.length>0&&(0,t.jsxs)(n.default,{children:[(0,t.jsx)("h3",{className:"font-bold text-gray-900 mb-3",children:"타입 선택"}),(0,t.jsx)("div",{className:"grid grid-cols-2 gap-2",children:g.apartmentTypes.map(e=>(0,t.jsx)("button",{onClick:()=>D(e.id),className:`p-3 rounded-xl border-2 text-left transition-colors ${B===e.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,children:(0,t.jsx)("p",{className:`text-sm font-medium ${B===e.id?"text-blue-700":"text-gray-700"}`,children:e.name})},e.id))})]}),B&&J.length>0&&(0,t.jsx)(n.default,{children:(0,t.jsx)(u,{items:J,paymentStages:g.config.paymentStages||[]})}),!B&&g.apartmentTypes.length>1&&(0,t.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-3 text-center",children:(0,t.jsx)("p",{className:"text-sm text-yellow-700",children:"타입을 선택하면 가격이 표시됩니다."})}),(0,t.jsxs)(n.default,{children:[(0,t.jsx)("h3",{className:"font-bold text-gray-900 mb-3",children:"계약자 정보"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"이름"}),(0,t.jsx)("input",{type:"text",value:z,onChange:e=>R(e.target.value),className:"w-full px-4 py-2.5 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"연락처"}),(0,t.jsx)("input",{type:"tel",value:L,onChange:e=>P(e.target.value),className:"w-full px-4 py-2.5 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]})]}),g.config.legalTerms&&(0,t.jsxs)(n.default,{children:[(0,t.jsx)("h3",{className:"font-bold text-gray-900 mb-2",children:"약관"}),(0,t.jsx)("div",{className:"max-h-32 overflow-y-auto text-xs text-gray-500 bg-gray-50 rounded-lg p-3 mb-3 whitespace-pre-wrap",children:g.config.legalTerms}),(0,t.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,t.jsx)("input",{type:"checkbox",checked:$,onChange:e=>M(e.target.checked),className:"w-5 h-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,t.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"약관에 동의합니다"})]})]}),(0,t.jsxs)(n.default,{children:[(0,t.jsx)("h3",{className:"font-bold text-gray-900 mb-2",children:"특이사항"}),(0,t.jsx)("textarea",{value:A,onChange:e=>H(e.target.value),placeholder:"특이사항이 있으면 입력해주세요 (선택)",rows:3,className:"w-full px-4 py-3 border border-gray-200 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"})]}),(0,t.jsxs)(n.default,{children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsx)("h3",{className:"font-bold text-gray-900",children:"서명"}),F&&(0,t.jsx)("button",{onClick:()=>{let e=U.current;if(!e)return;let t=e.getContext("2d");t&&t.clearRect(0,0,e.width,e.height),O(!1)},className:"text-xs text-red-500 hover:text-red-700",children:"지우기"})]}),(0,t.jsx)("canvas",{ref:U,width:350,height:150,className:"w-full border-2 border-dashed border-gray-300 rounded-xl bg-white cursor-crosshair touch-none",onMouseDown:q,onMouseMove:K,onMouseUp:Y,onMouseLeave:Y,onTouchStart:q,onTouchMove:K,onTouchEnd:Y}),!F&&(0,t.jsx)("p",{className:"text-xs text-gray-400 text-center mt-2",children:"위 영역에 서명해주세요"})]}),(0,t.jsxs)(i.default,{fullWidth:!0,size:"lg",onClick:G,loading:S,disabled:!$&&!!g.config.legalTerms||!B,children:[(0,t.jsx)(f.CheckCircle,{className:"w-5 h-5 mr-2"}),"계약 완료"]})]})]})})}e.s(["default",()=>j],70255)}]);