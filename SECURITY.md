# DealFlow ë³´ì•ˆ ê°€ì´ë“œë¼ì¸ v1.0

> **ìƒíƒœ**: ê¸°ëŠ¥ ê°œë°œ ì™„ë£Œ í›„ ì ìš© ì˜ˆì •
> **ìµœì¢… ì ê²€ì¼**: 2026-02-24
> **ë³´ì•ˆ ë“±ê¸‰**: D+ (ê²°ì œ ë„ì… ì „ B+ ì´ìƒ í•„ìš”)

---

## 1. í˜„ì¬ ë³´ì•ˆ í˜„í™© ìš”ì•½

| ì˜ì—­ | ë“±ê¸‰ | ìƒíƒœ |
|------|------|------|
| ì•„í‚¤í…ì²˜ (TypeORM, bcrypt, RBAC) | ğŸŸ¢ B | ê¸°ë³¸ ì„¤ê³„ ì–‘í˜¸ |
| ì¸ì¦/ì¸ê°€ (JWT, Guard) | ğŸŸ¡ C | êµ¬ì¡°ëŠ” ìˆìœ¼ë‚˜ ì„¤ì • ì·¨ì•½ |
| API ë³´ì•ˆ (CORS, Rate Limit, Headers) | ğŸ”´ F | ê±°ì˜ ë¯¸ì ìš© |
| í”„ë¡ íŠ¸ì—”ë“œ ë³´ì•ˆ (XSS, CSRF, í† í° ê´€ë¦¬) | ğŸ”´ D | localStorage ì‚¬ìš©, CSRF ì—†ìŒ |
| ë°°í¬/ì¸í”„ë¼ ë³´ì•ˆ | ğŸ”´ F | í¬ë¦¬ë´ì…œ ë…¸ì¶œ, HTTPS ë¯¸ê°•ì œ |
| ê²°ì œ ë³´ì•ˆ (PCI-DSS) | â¬œ N/A | ë¯¸êµ¬í˜„ |

---

## 2. CRITICAL â€” ì¦‰ì‹œ ì¡°ì¹˜ í•­ëª©

### 2.1 í¬ë¦¬ë´ì…œ ë…¸ì¶œ ì œê±°

| íŒŒì¼ | ë…¸ì¶œ í•­ëª© | ì¡°ì¹˜ |
|------|----------|------|
| `CLAUDE.md` | Cloudflare API Token | í™˜ê²½ë³€ìˆ˜ë¡œ ì´ë™, í† í° ì¬ë°œê¸‰ |
| `backend/.env` | SMTP ë¹„ë°€ë²ˆí˜¸ | `.env.example`ë§Œ ì»¤ë°‹, `.env`ëŠ” `.gitignore` |
| `CLAUDE.md` | ê´€ë¦¬ì ê³„ì • ì •ë³´ | ë¬¸ì„œì—ì„œ ì œê±°, ì‹œë“œ í›„ ë³€ê²½ ê°•ì œ |

### 2.2 JWT Secret í•˜ë“œì½”ë”© ì œê±°

```
# í˜„ì¬ (ì·¨ì•½)
auth.service.ts â†’ secret: configService.get('JWT_SECRET') || 'dealflow-jwt-secret-key'
jwt.strategy.ts â†’ secretOrKey: configService.get('JWT_SECRET') || 'dealflow-jwt-secret-key'

# ìˆ˜ì • ë°©í–¥
- í´ë°± ì‹œí¬ë¦¿ ì œê±° â†’ í™˜ê²½ë³€ìˆ˜ ì—†ìœ¼ë©´ ì„œë²„ ê¸°ë™ ì‹¤íŒ¨í•˜ë„ë¡
- í”„ë¡œë•ì…˜ì€ render.yamlì˜ generateValue: true í™œìš©
- ìµœì†Œ 256bit ëœë¤ í‚¤ ì‚¬ìš©
```

### 2.3 temp-reset ì—”ë“œí¬ì¸íŠ¸ ì œê±°

```
# í˜„ì¬ (ì·¨ì•½) â€” auth.controller.ts:69
@Public()
@Post('temp-reset')  â† í•˜ë“œì½”ë”© ì‹œí¬ë¦¿ìœ¼ë¡œ ì•„ë¬´ ê³„ì • ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê°€ëŠ¥

# ì¡°ì¹˜: ì—”ë“œí¬ì¸íŠ¸ ì™„ì „ ì‚­ì œ ë˜ëŠ” ê´€ë¦¬ì ì¸ì¦ í•„ìˆ˜ë¡œ ë³€ê²½
```

### 2.4 CORS ì œí•œ

```
# í˜„ì¬ (ì·¨ì•½) â€” render.yaml
FRONTEND_URL: "*"  â† ëª¨ë“  ë„ë©”ì¸ í—ˆìš©

# ìˆ˜ì • ë°©í–¥
FRONTEND_URL: "https://dealflow.xenokev.workers.dev"
```

---

## 3. HIGH â€” 1~2ì£¼ ë‚´ ì¡°ì¹˜

### 3.1 JWT ì €ì¥ì†Œ ë³€ê²½

```
# í˜„ì¬ (ì·¨ì•½)
localStorage.setItem('accessToken', accessToken)  â† XSSë¡œ íƒˆì·¨ ê°€ëŠ¥

# ìˆ˜ì • ë°©í–¥
- accessToken â†’ httpOnly + Secure + SameSite=Strict ì¿ í‚¤
- refreshToken â†’ httpOnly ì¿ í‚¤ (ë³„ë„ path)
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ í† í° ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€í•˜ë„ë¡
```

### 3.2 í´ë¼ì´ì–¸íŠ¸ JWT ê²€ì¦

```
# í˜„ì¬ (ì·¨ì•½) â€” authStore.ts:86
const payload = JSON.parse(atob(token.split('.')[1]))  â† ì„œë²„ ê²€ì¦ ì—†ì´ ì‹ ë¢°

# ìˆ˜ì • ë°©í–¥
- ì•± ì´ˆê¸°í™” ì‹œ /api/auth/me ì—”ë“œí¬ì¸íŠ¸ë¡œ ì„œë²„ ê²€ì¦
- í´ë¼ì´ì–¸íŠ¸ ë””ì½”ë”©ì€ UXìš©ìœ¼ë¡œë§Œ, ê¶Œí•œ íŒë‹¨ì€ ì„œë²„ì—ì„œ
```

### 3.3 ê´€ë¦¬ì ì‹œë“œ ë¹„ë°€ë²ˆí˜¸

```
# í˜„ì¬ â€” seed.service.ts:23
bcrypt.hash('Admin1234!', 10)  â† ê³ ì • ë¹„ë°€ë²ˆí˜¸

# ìˆ˜ì • ë°©í–¥
- ì‹œë“œ ì‹œ ëœë¤ ë¹„ë°€ë²ˆí˜¸ ìƒì„± â†’ ì½˜ì†” ì¶œë ¥
- ì²« ë¡œê·¸ì¸ ì‹œ ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê°•ì œ
```

---

## 4. MEDIUM â€” ê²°ì œ ë„ì… ì „ í•„ìˆ˜

### 4.1 Security Headers (helmet)

```bash
npm install helmet
```

```typescript
// main.ts
import helmet from 'helmet';
app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      scriptSrc: ["'self'"],
      styleSrc: ["'self'", "'unsafe-inline'"],
      imgSrc: ["'self'", "data:", "https:"],
    },
  },
  hsts: { maxAge: 31536000, includeSubDomains: true },
}));
```

### 4.2 Rate Limiting

```bash
npm install @nestjs/throttler
```

```typescript
// app.module.ts
import { ThrottlerModule } from '@nestjs/throttler';

ThrottlerModule.forRoot([{
  ttl: 60000,    // 1ë¶„
  limit: 10,     // ë¡œê·¸ì¸: 10íšŒ/ë¶„
}])

// ì „ì—­ API: 100íšŒ/ë¶„
// ë¡œê·¸ì¸: 5íšŒ/ë¶„
// ë¹„ë°€ë²ˆí˜¸ ë¦¬ì…‹: 3íšŒ/ë¶„
```

### 4.3 CSRF ë³´í˜¸

```typescript
// ê²°ì œ ê´€ë ¨ ì—”ë“œí¬ì¸íŠ¸ì— CSRF í† í° í•„ìˆ˜
// Double Submit Cookie íŒ¨í„´ ë˜ëŠ” Synchronizer Token íŒ¨í„´ ì ìš©
```

### 4.4 ë¹„ë°€ë²ˆí˜¸ ì •ì±… ê°•í™”

```typescript
// í˜„ì¬: password.length < 8 ë§Œ ì²´í¬
// ìˆ˜ì •:
const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
// ìµœì†Œ 8ì, ëŒ€ë¬¸ì 1, ì†Œë¬¸ì 1, ìˆ«ì 1, íŠ¹ìˆ˜ë¬¸ì 1
```

### 4.5 ì•”í˜¸í•™ì  ì•ˆì „í•œ ëœë¤ ìƒì„±

```typescript
// í˜„ì¬: Math.random() ì‚¬ìš©
// ìˆ˜ì •:
import { randomBytes } from 'crypto';
const tempPassword = randomBytes(12).toString('base64url');
```

---

## 5. ê²°ì œ ë„ì… ì‹œ ì¶”ê°€ ë³´ì•ˆ ìš”êµ¬ì‚¬í•­

### 5.1 PCI-DSS ì¤€ìˆ˜

| í•­ëª© | ì„¤ëª… | êµ¬í˜„ ë°©ë²• |
|------|------|----------|
| ì¹´ë“œ ì •ë³´ ë¹„ì €ì¥ | ì¹´ë“œë²ˆí˜¸ ì„œë²„ ì €ì¥ ê¸ˆì§€ | PGì‚¬ í† í°í™” (í† ìŠ¤/í¬íŠ¸ì›) |
| ì „ì†¡ ì•”í˜¸í™” | ëª¨ë“  ê²°ì œ ë°ì´í„° TLS 1.2+ | HTTPS ê°•ì œ + HSTS |
| ì ‘ê·¼ ì œì–´ | ê²°ì œ ê´€ë ¨ DB ì ‘ê·¼ ì œí•œ | ë³„ë„ ì„œë¹„ìŠ¤ ê³„ì • + ìµœì†Œ ê¶Œí•œ |
| ê°ì‚¬ ë¡œê¹… | ê²°ì œ ê´€ë ¨ ëª¨ë“  ì•¡ì…˜ ê¸°ë¡ | ê²°ì œ ì‹œë„/ì„±ê³µ/ì‹¤íŒ¨/í™˜ë¶ˆ ë¡œê¹… |
| ì·¨ì•½ì  ìŠ¤ìº” | ì •ê¸°ì  ë³´ì•ˆ ì ê²€ | ë¶„ê¸°ë³„ ì·¨ì•½ì  ìŠ¤ìºë‹ |

### 5.2 ì „ìê¸ˆìœµê°ë…ê·œì •

| í•­ëª© | ìš”êµ¬ì‚¬í•­ |
|------|---------|
| ì „ìê¸ˆìœµì—… ë“±ë¡ | ê²°ì œëŒ€í–‰ ì‹œ ê¸ˆìœµìœ„ ë“±ë¡ í•„ìš” (PG ì´ìš© ì‹œ ë©´ì œ) |
| ì´ìš©ì ì¸ì¦ | ê²°ì œ ì‹œ ë³¸ì¸ í™•ì¸ (2FA ê¶Œì¥) |
| ê±°ë˜ ê¸°ë¡ ë³´ì¡´ | ìµœì†Œ 5ë…„ ë³´ê´€ |
| ì´ìƒ ê±°ë˜ íƒì§€ | FDS(Fraud Detection System) ì—°ë™ |

### 5.3 ì—ìŠ¤í¬ë¡œ ë³´ì•ˆ

| í•­ëª© | ì„¤ëª… |
|------|------|
| ìê¸ˆ ë¶„ë¦¬ | í”Œë«í¼ ìš´ì˜ìê¸ˆê³¼ ì—ìŠ¤í¬ë¡œ ìê¸ˆ ë¶„ë¦¬ |
| ì •ì‚° ì´ì¤‘ í™•ì¸ | ì–‘ì¸¡ í™•ì¸ í›„ì—ë§Œ ì •ì‚° ì‹¤í–‰ |
| í™˜ë¶ˆ í”„ë¡œì„¸ìŠ¤ | ë¶„ìŸ ì‹œ ìë™ ë™ê²° + ê´€ë¦¬ì ìŠ¹ì¸ |

---

## 6. ê°ì‚¬ ë¡œê¹… ì„¤ê³„

### í•„ìˆ˜ ë¡œê¹… í•­ëª©

| ì´ë²¤íŠ¸ | ê¸°ë¡ ë°ì´í„° | ìš©ë„ |
|--------|-----------|------|
| ë¡œê·¸ì¸ ì„±ê³µ/ì‹¤íŒ¨ | userId, IP, timestamp, userAgent | ë¬´ì°¨ë³„ ëŒ€ì… íƒì§€ |
| ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ | userId, timestamp | ê³„ì • íƒˆì·¨ íƒì§€ |
| ê¶Œí•œ ë³€ê²½ | targetUserId, oldRole, newRole, changedBy | ê¶Œí•œ ìƒìŠ¹ íƒì§€ |
| ê³„ì•½ ìƒì„±/ìˆ˜ì • | contractId, userId, ë³€ê²½ë‚´ì—­ | ê³„ì•½ ë¬´ê²°ì„± |
| ê²°ì œ ì‹œë„/ì™„ë£Œ/ì‹¤íŒ¨ | paymentId, amount, userId, status | ê²°ì œ ì´ìƒ íƒì§€ |
| ê´€ë¦¬ì ì•¡ì…˜ | adminId, action, targetResource | ë‚´ë¶€ ê°ì‚¬ |

---

## 7. ë³´ì•ˆ ì—…ë°ì´íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

ê¸°ëŠ¥ ê°œë°œ ì™„ë£Œ í›„ ì•„ë˜ ìˆœì„œë¡œ ì§„í–‰:

### Phase 1: ê¸´ê¸‰ (1ì¼)
- [ ] CLAUDE.mdì—ì„œ í¬ë¦¬ë´ì…œ ì œê±° + í† í° ì¬ë°œê¸‰
- [ ] temp-reset ì—”ë“œí¬ì¸íŠ¸ ì œê±°
- [ ] CORSë¥¼ íŠ¹ì • ë„ë©”ì¸ìœ¼ë¡œ ì œí•œ
- [ ] JWT í´ë°± ì‹œí¬ë¦¿ ì œê±°

### Phase 2: ì¸ì¦ ê°•í™” (3ì¼)
- [ ] JWT â†’ httpOnly ì¿ í‚¤ ì „í™˜
- [ ] ë¹„ë°€ë²ˆí˜¸ ì •ì±… ê°•í™”
- [ ] ê´€ë¦¬ì ì‹œë“œ ë¹„ë°€ë²ˆí˜¸ ëœë¤í™”
- [ ] Math.random â†’ crypto.randomBytes
- [ ] í´ë¼ì´ì–¸íŠ¸ JWT ê²€ì¦ ë¡œì§ ìˆ˜ì •

### Phase 3: API ë³´ì•ˆ (2ì¼)
- [ ] helmet ì ìš© (Security Headers)
- [ ] Rate Limiting ì ìš©
- [ ] CSRF ë³´í˜¸ êµ¬í˜„
- [ ] API Body ì‚¬ì´ì¦ˆ ì—”ë“œí¬ì¸íŠ¸ë³„ ì œí•œ

### Phase 4: ëª¨ë‹ˆí„°ë§ (2ì¼)
- [ ] ê°ì‚¬ ë¡œê¹… êµ¬í˜„
- [ ] ì—ëŸ¬ ë¡œê¹…ì—ì„œ ìŠ¤íƒíŠ¸ë ˆì´ìŠ¤ ì œê±° (í”„ë¡œë•ì…˜)
- [ ] ì´ìƒ ì ‘ê·¼ ì•Œë¦¼ ì„¤ì •

### Phase 5: ê²°ì œ ë³´ì•ˆ (ê²°ì œ ë„ì… ì‹œ)
- [ ] PCI-DSS ì²´í¬ë¦¬ìŠ¤íŠ¸ ì´í–‰
- [ ] 2FA/MFA êµ¬í˜„ (ê´€ë¦¬ì í•„ìˆ˜)
- [ ] FDS ì—°ë™
- [ ] ì—ìŠ¤í¬ë¡œ ë³´ì•ˆ êµ¬í˜„
- [ ] ì¹¨íˆ¬ í…ŒìŠ¤íŠ¸ ì‹¤ì‹œ

---

## 8. í˜„ì¬ ì˜ ë˜ì–´ ìˆëŠ” í•­ëª© (ìœ ì§€)

| í•­ëª© | êµ¬í˜„ ìƒíƒœ | íŒŒì¼ |
|------|----------|------|
| bcrypt í•´ì‹± (salt 10) | âœ… | `auth.service.ts` |
| TypeORM íŒŒë¼ë¯¸í„° ë°”ì¸ë”© | âœ… | ì „ì²´ ì„œë¹„ìŠ¤ |
| class-validator + whitelist | âœ… | `main.ts` |
| UUID ê¸°ë³¸í‚¤ | âœ… | ì „ì²´ Entity |
| @Roles RBAC | âœ… | `admin.controller.ts` ë“± |
| passwordHash select:false | âœ… | `user.entity.ts:56` |
| ì—ëŸ¬ ë©”ì‹œì§€ ì¼ë°˜í™” | âœ… | `auth.service.ts:83` |

---

*ì´ ë¬¸ì„œëŠ” ê¸°ëŠ¥ ê°œë°œ ì™„ë£Œ í›„ ë³´ì•ˆ ì—…ë°ì´íŠ¸ ì‹œ ì°¸ê³ ìš©ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*
*ê²°ì œ ë„ì… ì „ ë°˜ë“œì‹œ Phase 1~4ë¥¼ ì™„ë£Œí•˜ê³ , Phase 5ëŠ” ê²°ì œ ê°œë°œê³¼ ë³‘í–‰í•©ë‹ˆë‹¤.*
